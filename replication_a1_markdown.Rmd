---
title: "Replication Econometrics III -- A1"
author: "Calebe Piacentini and Giovanni"
date: "2024-01-25"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(dplyr)
library(quantmod)
library(forecast)
library(lubridate)
library(gt)
```

## What do we need to replicate?

As exposed in the guidelines, we need to replicate all tables and figures **except** for the parts involving models RGM, VAR, RGMVAR, MDL1 and MDL2.

Altering table 2 from the paper to exclude these models, we have:

```{r models}
# Create the data frame
models_table <- data.frame(
 Description = c(
  "Time-series models", # 1
  "", # 2
  "", # 3
  "", # 4
  "Phillips curve (OLS)", # 5
  "", # 6
  "", # 7
  "", # 8
  "", # 9
  "", # 10
  "", # 11
  "", # 12
  "", # 13
  "", # 14
  "OLS term structure models", # 15
  "", # 16
  "", # 17
  "", # 18
  "", # 19
  "", # 20
  "", # 21
  "", # 22
  "", # 23
  "", # 24
  "", # 25
  "Inflation surveys", # 26
  "", # 27
  "", # 28
  "", # 29
  "", # 30
  "", # 31
  "", # 32
  "", # 33
  "" # 34
 ),
 Abbreviation = c(
  "ARMA", # 1
  "AR", # 2
  "RW", # 3
  "AORW", # 4
  "PC1", # 5
  "PC2", # 6
  "PC3", # 7
  "PC4", # 8
  "PC5", # 9
  "PC6", # 10
  "PC7", # 11
  "PC8", # 12
  "PC9", # 13
  "PC10", # 14
  "TS1", # 15
  "TS2", # 16
  "TS3", # 17
  "TS4", # 18
  "TS5", # 19
  "TS6", # 20
  "TS7", # 21
  "TS8", # 22
  "TS9", # 23
  "TS10", # 24
  "TS11", # 25
  "SPF1", # 26
  "SPF2", # 27
  "SPF3", # 28
  "LIV1", # 29
  "LIV2", # 30
  "LIV3", # 31
  "MICH1", # 32
  "MICH2", # 33
  "MICH3" # 34
 ),
 Specification = c(
  "ARMA(1,1)", # 1
  "Autoregressive model", # 2
  "Random walk on quarterly inflation", # 3
  "Random walk on annual inflation", # 4
  "INFL + GDPG", # 5
  "INFL + GAP1", # 6
  "INFL + GAP2", # 7
  "INFL + LSHR", # 8
  "INFL + UNEMP", # 9
  "INFL + XLI", # 10
  "INFL + XLI-2", # 11
  "INFL + FAC", # 12
  "INFL + GAP1 + LSHR", # 13
  "INFL + GAP2 + LSHR", # 14
  "INFL + GDPG + RATETS", # 15
  "INFL + GAP1 + RATETS", # 16
  "INFL + GAP2 + RATETS", # 17
  "INFL + LSHR + RATETS", # 18
  "INFL + UNEMP + RATETS", # 19
  "INFL + XLI + RATETS", # 20
  "INFL + XLI-2 + RATETS", # 21
  "INFL + FAC + RATETS", # 22
  "INFL + SPDTS", # 23
  "INFL + RATE + SPDTS", # 24
  "INFL + GDPG + RATE + SPDT", # 25
  "VAR(1) on RATE, SPD, INFL, GDPG", # 26
  "Linear bias-corrected SPF", # 27
  "Non-linear bias-corrected SPFLIV1", # 28
  "Livingston survey", # 29
  "Linear bias-corrected Livingston", # 30
  "Non-linear bias-corrected Livingston", # 31
  "Michigan survey", # 32
  "Linear bias-corrected Michigan", # 33
  "Non-linear bias-corrected Michigan" # 34
 )
)

knitr::kable(models_table)
```


## Loading Data

Data from the paper.

```{r load_data}

process_inflation_data <- function(file_path, var_label) {
  df <- read_csv(file_path) %>%
    select(year = Year, value = Value) %>%
    group_by(year) %>% 
    mutate(month = rep(1:12), quarter = rep(1:4, each = 3)) %>% 
    ungroup() %>% 
    mutate(variable = var_label) %>% 
    select(variable, year, quarter, month, value) %>% 
    arrange(variable, year, month)
  
  return(df)
}

# Process each dataset
punew_df <- process_inflation_data("data/punew_1947-2023.csv", 'punew')
puxhs_df <- process_inflation_data("data/puxhs_1947-2023.csv", "puxhs")
puxx_df <- process_inflation_data("data/puxx_1957-2023.csv", "puxx")
#
pce_df <- read_csv("data/pce_DPCERD3Q086SBEA_1947-2023.csv") %>%
  rename(value = "DPCERD3Q086SBEA") %>% 
  mutate(variable = "pce",
         year = year(DATE)) %>% 
  filter(year!=2023) %>% 
  group_by(year) %>% 
  mutate(quarter=rep(1:4)) %>% 
  ungroup() %>% 
  select(variable, year, quarter, value)

# join all inflation data 
# group data by quarters
# join with pce data
# make it wide
merged_df <- bind_rows(list(punew_df, puxhs_df, puxx_df)) %>%
  group_by(variable, year, quarter) %>% 
  summarise(across(everything(), last)) %>% 
  ungroup() %>% 
  bind_rows(pce_df) %>% 
  select(-month) %>% 
  pivot_wider(names_from = variable, values_from = value)
  
# calculating the inflation
df_inflation <- merged_df %>% 
  mutate(across(punew:pce, ~ log(./lag(.)), .names = 'inflation_{col}'))

print(merged_df)

```

And now data from Brazil.

## Summary statistics

Here we replicate table 1 of Summary Statistics from the paper.

First, we do it for the exactly the period of their analysis. It's worth noting that although their first year of analysis is 1952, PUXX only starts to have data at 1957 (even though they use data starting from 1958).

```{r summary_statistics}
# define the periods
year_start <- c(1952, 1986, 1996)
quarter_start <- c(1, 2, 2)
year_end <- 2002

# todo: loop this then join all three panels into one latex
# one possibility is to add this in the function below
data_subset <- df_inflation %>% 
      filter(year >= 1952, quarter >= 1) %>% 
      filter(year <= 2002)

data_variables <- select(data_subset, starts_with('inflation'))

means <- round(colMeans(data_variables, na.rm = T),3)
sds <- data_variables %>% summarise(across(everything(), ~ sd(., na.rm=T)))
autocorrelation_quaterly <- data_variables %>% summarise(across(everything(), ~ cor(., lag(., 4), use='complete.obs')))
corr_table <- round(cor(data_variables, use = 'complete.obs'), 2)
corr_table[!lower.tri(corr_table)] <- NA

panel_a <- bind_rows(list(means, sds, autocorrelation_quaterly, as.data.frame(corr_table)))

panel_summary <- function(inflation_data, year_start, quarter_start, year_end){
  data_subset <- inflation_data %>% 
      filter(year >= year_start, quarter >= quarter_start) %>% 
      filter(year <= year_end)
    
    means <- round(rowMeans(data_subset[, 3:ncol(data_subset)]), 2)
}

# loop
for (y_start in year_start) {
  for (q_start in quarter_start) {
    # filtering the data for each panel
    
  }
}

```


